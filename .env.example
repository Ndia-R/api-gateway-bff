# ============================================
# Common Configuration
# ============================================
# VPSのホスト名（開発環境・本番環境共通）
# 開発環境: localhost
# 本番環境: vsv-emerald.skygroup.local
#
# この値を変更すると、以下のURLが自動的に更新されます:
# - IDP_REDIRECT_URI
# - IDP_POST_LOGOUT_REDIRECT_URI
# - DEFAULT_FRONTEND_URL
# - CORS_ALLOWED_ORIGINS（デフォルト値）
VPS_HOSTNAME=localhost

# ============================================
# Identity Provider (IdP) Configuration
# ============================================
# 使用サービス: api-gateway-bff
#
# 📝 以下のBFF関連URLはdocker-compose.ymlで ${VPS_HOSTNAME} から自動生成されます:
#    - IDP_REDIRECT_URI: https://${VPS_HOSTNAME}/bff/login/oauth2/code/idp
#    - IDP_POST_LOGOUT_REDIRECT_URI: https://${VPS_HOSTNAME}/logout-complete
#    - DEFAULT_FRONTEND_URL: https://${VPS_HOSTNAME}
#
# 注: IDP_POST_LOGOUT_REDIRECT_URIは、現在の実装ではBFFがバックエンドから
#     WebClientでIDプロバイダーにログアウトリクエストを送信するため、
#     ブラウザには届きません。OIDC仕様準拠のためパラメータとして送信されます。

IDP_CLIENT_ID=api-gateway-bff-client
IDP_CLIENT_SECRET=your-client-secret
IDP_ISSUER_URI=https://vsv-crystal.skygroup.local/auth/realms/sample-realm

# ============================================
# CORS Configuration (Multiple Origins Support)
# ============================================
# 使用サービス: api-gateway-bff
#
# 許可するオリジンのリスト（カンマ区切り）
# BFFは、Refererヘッダーから動的にリダイレクト先を決定しますが、
# セキュリティ検証のためCORS_ALLOWED_ORIGINSで許可リストを管理します。
#
# 【同一VPS + Nginx構成】開発環境・本番環境（デフォルト）:
CORS_ALLOWED_ORIGINS=https://${VPS_HOSTNAME}
#
# 【異なるVPS構成】複数の独立したドメインを持つ場合（例）:
# CORS_ALLOWED_ORIGINS=https://books.example.com,https://music.example.com
#
# 注: ワイルドカード対応（例: https://*.example.com）

# ============================================
# BFF Application Configuration - Resource Servers
# ============================================
# 使用サービス: api-gateway-bff
#
# リソースサーバーのリスト（カンマ区切り）
# この環境変数でサービスを追加・削除できます（Dockerイメージ再ビルド不要）
RESOURCE_SERVERS=service-01

# 各サービスの設定
# SERVICE_xx_URL: docker composeネットワーク内のサービス名（必須）
# SERVICE_xx_PATH_PREFIX: 各サービスのパスプレフィックス（必須）

# Service 01 (my-books)
SERVICE_01_URL=http://my-books-api:8080
SERVICE_01_PATH_PREFIX=/my-books

# 追加サービスの例（コメントアウト）
# Service 02 (my-music) を追加する場合:
# 1. RESOURCE_SERVERSに追加: RESOURCE_SERVERS=service-01,service-02
# 2. 以下のコメントを外して設定を追加:
# SERVICE_02_URL=http://my-music-api:8080
# SERVICE_02_PATH_PREFIX=/my-music

# ============================================
# Logging Configuration
# ============================================
# LOG_LEVEL (root):
#   開発環境: DEBUG or INFO
#   本番環境: INFO or WARN
#
# LOG_LEVEL_SECURITY (Spring Security関連):
#   開発環境: DEBUG or INFO（認証フローのデバッグ用）
#   本番環境: WARN（ノイズ削減）
#
LOG_LEVEL=INFO
LOG_LEVEL_SECURITY=INFO

# ============================================
# Session Configuration
# ============================================
# 使用サービス: api-gateway-bff
#
# セッションタイムアウト（Duration形式: 30m, 12h, 1d など）
# この値は spring.session.timeout と cookie.max-age の両方に適用されます
# デフォルト: 12h
SESSION_TIMEOUT=12h

# セッションCookieのSecure属性
# - false: HTTP環境（開発環境）
# - true: HTTPS環境（本番環境）
# デフォルト: false
SESSION_COOKIE_SECURE=false

# ============================================
# Security Settings - Rate Limit (オプション)
# ============================================
# 使用サービス: api-gateway-bff
#
# 以下の設定はデフォルト値が設定されているため、
# カスタマイズが必要な場合のみコメント解除して使用してください

# レート制限機能の有効/無効（デフォルト: true）
# RATE_LIMIT_ENABLED=true

# 認証エンドポイントのレート制限（デフォルト: 30リクエスト/分）
# RATE_LIMIT_AUTH_RPM=30

# APIプロキシのレート制限
# 認証済みユーザー（デフォルト: 200リクエスト/分）
# RATE_LIMIT_API_AUTHENTICATED_RPM=200

# 未認証ユーザー（デフォルト: 100リクエスト/分）
# RATE_LIMIT_API_ANONYMOUS_RPM=100
